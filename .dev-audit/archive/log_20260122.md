# 2026-01-22 实现离线只读模式与 UI 降级

## 任务背景
针对本地/免费转录服务器不稳定的情况，优化前端在后端离线状态下的用户体验。

## 实施内容
1. **自动状态感知**：
   - 在 `tasks/page.tsx` 和 `Sidebar.tsx` 中集成后端在线检测逻辑（30秒轮询）。
   - 捕捉网络异常并自动切换 UI 状态。
2. **UI 降级方案**：
   - **全局通知**：后端离线时，在处理中心顶部显示醒目的“只读模式”通知（琥珀色提示框）。
   - **功能锁定**：离线状态下禁用“立即处理”按钮和文件上传功能。
   - **引导付费**：将“云端推理”选项标注为“付费功能开发中”并设为不可选，旨在降低用户预期并为未来功能铺路。
3. **状态指示器**：
   - 侧边栏用户头像下方新增状态点（绿色：在线；灰色：离线），提供实时反馈。
4. **多语言支持**：
   - 在 `zh.json` 和 `en.json` 中补齐了所有相关的提示语。

## 验证结果
- 经测试，当后端无响应或隧道断开时，前端能正确识别并展示离线通知，同时禁用提交交互。
- 修复了在实施过程中引入的 JSX 嵌套及标签关闭错误。
- 确认多语言切换功能在离线通知中正常工作。
\n## 异常修复：解决请求死循环问题\n- **原因分析**：在 `tasks/page.tsx` 中，`useEffect` 同时依赖 `user` 对象并更新 `user` 状态。由于 session 用户对象引用不一致导致了无限请求循环，触发了 `ERR_INSUFFICIENT_RESOURCES`。\n- **修复方案**：将身份验证与数据获取逻辑分离，并将数据获取依赖项改为 `user?.id`。\n- **验证**：页面请求频率恢复正常，无报错。
