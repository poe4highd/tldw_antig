# 2026-01-18 开发日志 (Part 3)

## 任务：实现一键开发启动脚本

### 1. 方案实施
- **脚本编写**：创建 `dev.sh`，利用后台进程控制和 `sed` 工具实现日志着色及前缀注入。
- **功能优化**：增加了对 `backend/venv` 的自动识别，简化了开发者在不同环境下的切换。
- **集成**：更新 `README.md`，将此脚本推荐为首选开发启动方式。

### 2. 回顾
- **便捷性**：通过一个命令即可管理两个复杂服务的生命周期，提升了开发效率。
- **可维护性**：脚本逻辑简单透明，易于后续根据需求添加更多启动检查。

---

## 任务：实现项目历史展示功能

### 1. 需求背景
- **问题描述**：需要将项目内部的审计记录（PROJECT_HISTORY.md）暴露在前端页面上，增加透明度和可追溯性。

### 2. 方案实施
- **后端**：添加了专用路由，通过 Python 流式读取 Markdown 并解析为结构化 JSON。
- **前端**：创建了 `/project-history` 路由，采用深色模式友好的时间轴布局。
- **集成**：在网站页脚添加了入口链接。

### 3. 回顾
- **性能**：由于 Markdown 文件体积较小，接口响应极快，无需额外数据库存储，降低了维护成本。
- **UI/UX**：页面采用了精美的卡片设计和 Lucide 图标，具备良好的阅读体验。

---
- **修复结果**：通过在 `downloader.py` 中使用延迟导入，LSP 的栈溢出问题得到根本解决，文件编辑体验恢复流畅。
- **存储优化**：实现了“即时自动化删除”（提取音频后删除原视频）和“定期清理”（3天周期清理大文件）的双重保障。
- **首次执行**：`cleanup_downloads.py` 成功释放 469.30 MB 空间。

### 4. 经验
- **LSP 调优**：对于依赖复杂外部库的项目，保持顶层导入简洁是维持 IDE 性能的关键。
- **资源最小化**：在多媒体处理流程中，尽早转换并裁剪原始大文件是成本控制的最佳实践。

---
# 2026-01-18 开发日志

## 任务：诊断并解决 LSP (Pyrefly) 崩溃问题

### 1. 需求背景
- **问题描述**：LSP 服务器 `Pyrefly` 在打开 `backend/downloader.py` 时反复发生 `stack overflow` 崩溃。
- **关键 Error**：`thread '<unknown>' (5606705) has overflowed its stack`

### 2. 方案计划
- **初步诊断**：怀疑是 LSP 在解析 `yt-dlp` 复杂类型树时发生了无限递归。
- **实施方案**：
    1. 将 `backend/downloader.py` 中的 `import yt_dlp` 改为函数内延迟导入。
    2. 验证后端服务功能不受影响。
    3. 观察 LSP 是否恢复稳定。

---
