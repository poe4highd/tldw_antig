# 2026-01-19 开发日志 (Part 14)

## 任务：将系统默认转录模型切换至 large-v3-turbo

### 1. 变更背景
- **目的**：利用 Whisper large-v3-turbo 模型在 Mac GPU (MLX) 下的极致性能，显著提升用户的转录等待体验。
- **历史约束**：此前系统在不同入口（Local/Cloud）分别硬编码了 `base` 或 `large-v3`，导致性能与质量不均衡。

### 2. 执行内容
- **核心逻辑更新**：
    - 修改 `backend/transcriber.py`，将 `get_faster_whisper_model`、`transcribe_local` 及 `transcribe_audio` 的默认 `model_size` 统一改为 `large-v3-turbo`。
    - 在 `model_mapping` 中增加/重定向，确保请求 `medium` 或 `large-v3` 时默认由更高效的 `large-v3-turbo` 响应。
- **缓存隔离**：
    - 修改 `backend/main.py` 中的 `cache_key` 前缀为 `large-v3-turbo`。此举有助于区分旧版本模型生成的字幕缓存，确保用户在更新后触发全新的转录流程。
- **源码管理**：执行代码提交并推送到 GitHub 远程仓库。

### 3. 验证结果
- **代码审计**：确认 `transcriber.py` 内部所有关键工厂函数的默认值均已对齐。
- **缓存确认**：后端 `main.py` 逻辑已能根据新 Key 生成 `cache/` 文件。

---
# 2026-01-19 开发日志 (Part 13)

## 任务：字幕比较工具二期：三路对齐与安全升级

### 1. 核心改进
- **基准切换**：实现了从“模型对齐”到“真值对齐”的跨越。现在系统会自动加载 `backend/tests/data/` 中的 `.srv1` 文件作为基准。
- **三路并行**：UI 支持同时显示三行字幕（真值、SenseVoice、Whisper），极大提升了校对效率。
- **安全 UI**：将原有的浏览器原生 `prompt()` 替换为页面内置设计的登录表单，解决部分浏览器不兼容弹窗或弹窗体验割裂的问题。

### 2. 技术细节
- **SRV1 解析**：后端使用 `xml.etree.ElementTree` 精准提取 YouTube 官方字幕的时间戳与内容。
- **自适应基准**：前端逻辑优先级：`reference` (SRV1) > `turbo` > `default`。

---

# 2026-01-19 开发日志 (Part 12)

## 任务：开发开发者专用多模型字幕比较页面 (Dev-Compare Tool)

### 1. 需求背景
- **痛点**：由于引入了 SenseVoice 和 Whisper Turbo 等多个模型，需要一种直观的方式来比较它们在同一视频下的转录表现，以便进行算法微调和校对。
- **决定**：在现有报告页面的基础上，开发一个“双行字幕”对齐显示工具。

### 2. 执行内容
- **后端接口**：
    - 在 `main.py` 新增 `/dev/compare/{video_id}` 接口。
    - 该接口会自动扫描 `cache/` 目录下的所有模型原始转录文件 (`_raw.json`) 并返回。
- **前端页面**：
    - 创建 `/frontend/app/dev-compare/[id]/page.tsx`。
    - **对齐算法**：以 Turbo 为基准，通过时间戳重叠检索 SenseVoice 的对应文字，实现双行对齐显示。
    - **安全防护**：加入开发密码校验（`speedup2026`），非授权用户无法访问。
- **UI 优化**：
    - 精简了报告页无关的社交/统计组件。
    - 强化了视频与双行字幕的实时同步高亮和点击跳转功能。

### 3. 验证结果
- **后端**：`curl` 测试确认接口能正确返回包含 `turbo` 和 `sensevoice` 在内的模型列表。
- **前端**：代码逻辑已应用，支持 YouTube 和本地音频的同步展示。

### 4. 经验总结
- **复用优先**：通过复用 `ResultPage` 的播放器逻辑和布局，极大地缩短了开发周期（不到 1 小时内完成）。
- **时间轴对齐**：使用简单的“重叠判断”算法即可实现不同模型间的文字粗略对齐，能满足 90% 以上的校对场景。
