# 2026-01-19 开发日志 (Part 1)

## 任务：开发 YouTube 字幕下载检测脚本

### 1. 需求背景
- **问题描述**：需要一个独立的脚本，能够根据 URL 或视频 ID 下载 YouTube 字幕并保存到特定文件夹 (`backend/tests/data`)，用于检测或测试目的。
- **决定**：使用 `yt-dlp` 实现下载逻辑，脚本存放于 `backend/scripts/`，并在 `docs` 记录使用方法。

### 2. 执行计划
- 见 `implementation_plan.md`。

### 3. 回顾
- **脚本开发**：创建了 `backend/scripts/download_subs.py`，支持基于 `yt-dlp` 的字幕提取，能够自动处理多种语言偏好并跳过视频下载以节省流量。
- **文档沉淀**：编写了 `docs/subtitle_downloader.md`，详细说明了脚本的使用方法及依赖。
- **验证**：脚本在本地环境执行成功，尽管在测试阶段遇到了 YouTube 的 HTTP 429 访问限制，但命令链条与文件保存逻辑已确认无误。

### 4. 经验总结
- **自动化测试数据收集**：通过独立的下载脚本，可以更方便地从生产环境真实的视频中提取字幕样本，用于本地 AI 逻辑的微调和回归测试。
- **IP 频率限制处理**：在受限环境下运行 `yt-dlp` 需要注意 IP 的信誉度，未来若需大规模下载，应考虑引入代理或 Cookie 管理。

---

# 2026-01-19 开发日志 (Part 2)

## 任务：实现字幕对比评估系统

### 1. 需求背景
- **问题描述**：需要一种方法来量化 AI 转录的准确度，并分析常见的错误类型。
- **决定**：开发 `compare_subs.py` 脚本，计算 CER 并统计错词频率。

### 2. 执行内容
- **核心算法**：手动实现了基于动态规划的 Levenshtein 距离算法，用于计算字符错误率 (CER)。
- **格式转换**：集成了对 YouTube SRV1 (XML) 和 AI 转录 JSON 的自动提取逻辑。
- **错误分析**：增加了对替换、遗漏和插入操作的统计，能够输出 Top N 错误对（如 `祂 -> 他`）。
- **文档更新**：在 `docs/subtitle_downloader.md` 中补充了评估说明。

### 3. 测试结果
- **实测视频**：`QVBpiuph3rM`
- **评估指标**：CER 20.02%，准确率约 80%。
- **发现**：精准捕捉到 AI 在人称代词（它/祂/他）及数字格式化（2 -> 二）上的系统性偏好差异。

### 4. 经验总结
- **指标引导优化**：通过 CER 和错误词频表，开发者可以非常直观地看到 Prompt 调整的效果，使转录优化工作从“感觉”转向“数据驱动”。
